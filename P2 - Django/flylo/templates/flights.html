{% extends 'base.html' %}
{% load static %}


{% block style %}
	<style>

		input[type=checkbox] {
			/* Double-sized Checkboxes */
			-ms-transform: scale(1.5); /* IE */
			-moz-transform: scale(1.5); /* FF */
			-webkit-transform: scale(1.5); /* Safari and Chrome */
			-o-transform: scale(1.5); /* Opera */
			padding: 10px;
		}

		.table td {
			text-align: center;
		}

		.table th {
			text-align: center;
		}

		.table .added td{
			background-color : #f39c12;
			color:white;

		}


	</style>

	<link rel="stylesheet" href="{% static 'css/transitions.vue.css' %}">
{% endblock %}


{% block content %}

	{% if flights %}

		{% if departure %}
			<h3>Showing Flights departing from {{ departure }}:</h3>
		{% else %}
			<h3>Avaliable Flights:</h3>
		{% endif %}

		<hr>

		<form action="{% url 'flylo:shoppingcart' %}" method="post" style="display: none">
			{% csrf_token %}
			<table class="table table-striped table-hover table-responsive">
				<thead>
				<tr>
					<th>Add to Cart</th>
					<th>Departure</th>
					<th>Arrival</th>
					<th>Return Trip</th>
					<th>Flight No.</th>
					<th>Airline</th>
					<th>No. Seats</th>
					<th>Class</th>
					<th>Price</th>
				</tr>
				</thead>

				{% for flight in flights %}
					<tr id="flight{{ flight.id }}">

						<td>
							<div class="">
								<input type="checkbox" id="selected_going{{ flight.id }}"
									   name="selected_going{{ flight.id }}" value="{{ flight.id }}">
							</div>
						</td>

						<td class="h4"><b class="label label-primary">{{ flight.location_departure }}</b></td>
						<td class="h4"><b class="label label-primary">{{ flight.location_arrival }}</b></td>

						<td>
							<label for="return_flight{{ flight.id }}">
								<input type="checkbox"
									   name="return_flight{{ flight.id }}"
									   id="return_flight{{ flight.id }}"
									   value="{{ flight.id }}"
									   data-toggle="toggle" data-size="mini"
									   data-on="Yes" data-off="No">
							</label>
						</td>

						<td><a href="{% url 'flylo:flights' pk %}{{ flight.pk }}">
							{{ flight.flight_number }} ({{ flight.pk }})</a></td>
						<td>
							<select name="airline{{ flight.id }}" class="form-control input-sm">
								{% for a in flight.airlines.all %}
									<option value="{{ a }}">{{ a }}</option>
								{% endfor %}
							</select>
						</td>

						<td class="center">
							<select class="form-control input-sm" name="seats{{ flight.id }}">
								<option value="1">1 Seat</option>
								<option value="2">2 Seats</option>
								<option value="3">3 Seats</option>
								<option value="4">4 Seats</option>
								<option value="5">5 Seats</option>
							</select>
						</td>

						<td class="center">
							<select name="type{{ flight.id }}" class="form-control input-sm">
								<option value='e'>Economy</option>
								<option value='b'>Business</option>
								<option value='f'>First Class</option>
							</select>
						</td>

						<td class="h4">
							<span class="label label-warning" id="price">00.00€</span>
						</td>

					</tr>
				{% endfor %}

			</table>
			<input type="submit" class="btn btn-primary pull-right" value="Go to Shopping Cart">
		</form>

	{% else %}
		<p>No flights are available.</p>
	{% endif %}

	<div class="clearfix"></div>

	{#		<div v-for="f in flights" class="well">#}
	{#			${f.flight_number} : ${f.price}&euro;#}
	{#		</div>#}

	<div id="app">


		<form action="{% url 'flylo:shoppingcart' %}" method="post" >
			{% csrf_token %}
			<table class="table table-striped table-hover table-responsive">
				<thead>
				<tr>
					<th>FN</th>
					<th>Return?</th>
					<th>Departure</th>
					<th>Arrival</th>
					<th>Ariline</th>
					<th>Seats</th>
					<th>Class</th>
					<th>Price</th>
					<th></th>
				</tr>
				</thead>

				<tbody is="transition-group" name="fade">
				<tr is="flight" v-for="f in flights" :key="f.pk" :flight="f"></tr>
				</tbody>

			</table>
			<input type="submit" class="btn btn-primary pull-right" value="Go to Shopping Cart">

		</form>


	</div>

	<div class="clearfix"></div>
	<hr>

{% endblock %}


{% block scripts %}

	<script type="text/javascript">

        var csrf = '{{ csrf_token }}';
        var context = {
            departure: '{{ departure }}'
        };

        $(document).ready(function () {


            $("[id^=flight]").each(function (i, e) {

                e = $(e);
                getPrice(1, 1, 1, 'e', function (data) {
                    e.find("#price").text(data + "€")
                });

            });

            $("[name^=seats]").change(function (e) {
                var row = $(e.target).parent().parent()
                var nseats = row.find("[name^=seats]").val()
                var type = row.find("[name^=type]").val()
                //row.find("#price").text(nseats * 50 + ".00€")

                getPrice(1, 1, nseats, type, function (data) {
                    row.find("#price").text(data + "€")
                });

            });

        });

        getPrice = function (fid, aid, nseats, type, callback) {
            $.ajax({
                url: 'http://localhost:8080/flylo/api/price/' + fid + '/' + aid + '/' + nseats + '/' + type,
                type: 'GET',
                data: {
                    'csrfmiddlewaretoken': csrf
                },
                success: function (data) {
                    callback(data)
                }
            })
        }


	</script>

	<script type="text/javascript" src="{% static 'js/flights.vue.js' %}"></script>

{% endblock %}